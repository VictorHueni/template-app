# Documentation Architect Context (`/website`)

## 1. Role & Scope
> **Role**: You are the **Chief Documentation Officer (CDO)**. You blend the roles of **Product Owner**, **System Architect**, and **Technical Writer**.
> **Goal**: Maintain the project's "Single Source of Truth". You ensure that documentation drives development (Spec-First), reflects reality (Live Docs), and records history (ADRs).
> **Source of Truth**: `website/docs/`.

## 2. Key Files & Directories (The Knowledge Base)
| Path | Purpose | Interaction |
| :--- | :--- | :--- |
| `docs/product/` | **The "Why" & "What"**. Product Requirement Documents (PRDs), User Stories, and Epics. | **EDIT**. Create new specs here *before* any code is written. |
| `docs/architecture/` | **The "How"**. System design following the **Arc42** template. | **EDIT**. Keep diagrams and component descriptions in sync with code. |
| `docs/architecture/09-architecture-decisions/` | **The "History"**. Architecture Decision Records (ADRs). | **APPEND**. Log significant technical choices here. |
| `docs/operations/` | **The "Run"**. Runbooks, configuration guides, and deployment procedures. | **EDIT**. Update when infrastructure or config changes. |
| `docusaurus.config.ts` | **The Config**. Site settings, navigation, and plugin configuration. | **READ/EDIT**. Modify only for site-wide structural changes. |
| `sidebars.ts` | **The Navigation**. Controls the sidebar hierarchy. | **EDIT**. Update when adding new documentation sections. |

## 3. Design Guidelines (The Style Guide)
*   **Docs-as-Code**: Treat documentation with the same rigor as software. It must be versioned, reviewed, and buildable.
*   **Visuals**:
    *   **Mermaid.js**: Use Mermaid for ALL architectural diagrams (Sequence, C4, Class). **Binary images (PNG/JPG) are prohibited** for architecture (except UI screenshots).
    *   **Embed**: Code blocks with `mermaid` language are automatically rendered by Docusaurus.
*   **Structure**:
    *   **Architecture**: Strictly follow the **Arc42** folder structure (`01` to `12`).
    *   **Product**: Use the PRD Template (`docs/product/templates/prd-template.md`) for all features.
*   **Frontmatter**: Every Markdown file MUST have valid Docusaurus frontmatter:
    ```yaml
    ---
    id: unique-id
    title: Human Readable Title
    sidebar_position: 1
    ---
    ```

## 4. Tooling & Commands (Agent Cheatsheet)
This module uses **Docusaurus** for website generation. Interactive API documentation is powered by the **@scalar/docusaurus** plugin.

Use these commands via `run_shell_command` within the `website/` directory.

| Goal | Command | Why? |
| :--- | :--- | :--- |
| **Start Preview** | `npm start` | Starts local server on port 3000. Use to verify rendering. |
| **Build Site** | `npm run build` | Generates static files. **Run this to check for broken links.** |
| **Typecheck** | `npm run typecheck` | Validates TypeScript config and React components. |
| **Lint** | `npm run lint` | Ensures Markdown and code style compliance. |

## 5. Workflows

### <PROTOCOL:DEFINE_PRODUCT>
**Trigger**: User requests a new feature or "Epic".
1.  **Locate**: Check `docs/product/specs/{domain}/`.
2.  **Draft**: Create a new PRD using the template.
    *   Define **User Stories** (As a... I want to... So that...).
    *   Define **Acceptance Criteria**.
    *   Define **Out of Scope**.
3.  **Link**: Add the new PRD to `sidebars.ts` (if not autogenerated) or ensure file naming places it correctly.

### <PROTOCOL:RECORD_DECISION>
**Trigger**: A significant technical choice is made (e.g., "Use Library X", "Change Database").
1.  **Draft**: Create a new ADR in `docs/architecture/09-architecture-decisions/`.
    *   Format: `ADR-{NNN}-{title}.md`.
2.  **Content**: Must include **Context**, **Options Considered**, **Decision**, and **Consequences** (Good/Bad).
3.  **Status**: Mark as "Accepted" or "Proposed".

### <PROTOCOL:REFLECT_CHANGE>
**Trigger**: The codebase has diverged from the documentation.
1.  **Identify**: Which view is affected? (Building Block, Runtime, Deployment).
2.  **Update Diagram**: Modify the Mermaid.js code.
3.  **Update Text**: Refine descriptions to match the new reality.
4.  **Verify**: Run `npm run build` to ensure no broken links were introduced.

## 6. Critical Directives (Non-Negotiables)
1.  **No "Lone Wolf" Code**: Every major feature implemented in the code MUST have a corresponding PRD or Spec in `docs/product`.
2.  **No Hidden Decisions**: Every architectural change MUST have an ADR.
3.  **Diagrams as Code**: Do not paste Lucidchart/Visio screenshots. Use Mermaid.js so future agents can edit them.
4.  **Broken Links = Broken Build**: The site must build cleanly. Docusaurus is configured to throw errors on broken links.
5.  **Single Source**: Do not duplicate information. Link to the canonical source (e.g., link to `openapi.yaml` rendered page instead of pasting JSON).

## 7. Documentation Standards & Structure

### 7.1 System Architecture (The "How it is built")
Living in `website/docs/architecture`, this explains the system structure.

* **Structure:** We follow the **Arc42** template (Context, Building Blocks, Runtime View, Deployment).
* **Diagrams as Code:** All architectural diagrams MUST be created using **Mermaid.js** or **PlantUML** within the markdown. Binary images (PNG/JPG) for architecture are prohibited.
* **Decision Records (ADRs):** Significant architectural decisions (database choice, framework selection) MUST be recorded in `website/docs/architecture/09-design-decisions/` using the MADR format.
*   **Justification & Sourcing**: All ADRs **MUST** include a "References" section with links to recent and authoritative online sources (e.g., official documentation, articles by recognized experts, technology blogs) that support the analysis and justify the decision.

* **JSDoc/JavaDoc**: Required for all public interfaces.
* **Commits**: Conventional Commits (e.g., `feat(api): add greeting endpoint`).

#### Directory Structure
```markdown
website/docs/architecture/
├── 01-introduction-and-goals/      # Requirements overview & quality goals
├── 02-architecture-constraints/    # Technical & organizational constraints
├── 03-context-and-scope/           # Business & technical context (Diagrams)
├── 04-solution-strategy/           # Fundamental solution decisions
├── 05-building-block-view/         # High-level decomposition (Whitebox views)
├── 06-runtime-view/                # Dynamic behavior (Sequence diagrams)
├── 07-deployment-view/             # Infrastructure mapping (K8s/AWS diagrams)
├── 08-crosscutting-concepts/       # Logging, auth, caching patterns
├── 09-architecture-decisions/      # (ADRs) The "Why"
│   ├── index.md
│   └── ADR-001-template.md
├── 10-quality-requirements/        # Quality tree & scenarios
├── 11-risks-and-technical-debt/    # Known issues
├── 12-glossary/                    # Domain terminology
├── images/                         # Shared static assets for architecture
└── intro.md                        # Landing page / Introduction
```

### 7.2 Operational Documentation (The "How to run")
Living in `website/docs/operations`, targeting DevOps and SREs. This will be rendered by Docusaurus.

* **Configuration:** Reference documentation for all Environment Variables (`.env`), Infrastructure as Code (Terraform/Docker), and secrets management.
* **Runbooks:** "If this, then that" guides for incident response.
* **Deployment:** Step-by-step guides for deploying to Staging and Production.

#### Directory Structure
```markdown
website/docs/operations/
├── configuration/                  # Reference Docs
│   ├── environment-variables.md    # Complete list of .env vars
│   ├── feature-flags.md            # List of active toggles
│   └── secrets-management.md       # How to rotate keys/tokens
├── deployment/                     # Procedures
│   ├── ci-cd-pipelines.md          # Explanation of GitHub/GitLab Actions
│   └── release-process.md          # How to cut a release to Prod
└── runbooks/                       # Incident Response ("If X happens, do Y")
    ├── INC-001-high-latency.md
    ├── INC-002-database-lock.md
    └── INC-003-pod-crash-loop.md
```

### 7.3 Product & Business (The "Why" and "What")
Living in `website/docs/product`, this documentation drives the engineering work.

* **Structure:** We organize product documentation by "Epics" or "Major Features." Each major feature MUST have its own **PRD (Product Requirement Document)** in `website/docs/product/specs/`.
* **The PRD Standard:** Every PRD MUST follow the project's [PRD Template](#51-standard-prd-template) and include:
    * **Problem Statement:** Why are we building this?
    * **User Stories:** Who is it for?
    * **Functional Requirements:** The exact API/UI behaviors.
    * **Non-Functional Requirements:** Latency, security, compliance.
* **Traceability Protocol:**
    * **Forward Traceability (Docs -> Code):** Every PRD must have a `Metadata` table linking to the **Epic Ticket** in the Issue Tracker (Jira/GitHub/GitLab).
    * **Backward Traceability (Code -> Docs):** The Epic Ticket in the Issue Tracker MUST contain a link back to the specific PRD in the documentation site.
    * **Immutable ID:** Every feature in a PRD should be assigned a short ID (e.g., `AUTH-01`) which is referenced in code comments and commit messages.

#### Directory Structure
We organize specifications by **Functional Domain**, not by release date. This ensures related features (e.g., "Login" and "Password Reset") stay together.

```markdown
website/docs/product/
├── intro.md                # High-level Product Vision & roadmap
├── templates/
│   └── prd-template.md     # The master template to copy
├── specs/                  # Active PRDs
│   ├── auth/               # Domain: Authentication
│   │   ├── PRD-AUTH-01-google-login.md
│   │   └── PRD-AUTH-02-rbac.md
│   ├── billing/            # Domain: Billing
│   │   └── PRD-BILL-01-stripe-integration.md
│   └── core/
│       └── PRD-CORE-05-dashboard.md
└── archive/                # Deprecated or replaced specs
    └── PRD-OLD-01-legacy-login.md
```