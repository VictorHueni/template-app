extends: ["spectral:oas"] # You can extend standard sets like 'spectral:oas'

rules:
  # Naming Convention: path segments must be kebab-case
  paths-kebab-case:
    description: "Path segments must be kebab-case."
    given: "$.paths[*]~"
    then:
      function: pattern
      functionOptions:
        match: "^(/|[a-z0-9-.]+|{[a-zA-Z0-9_]+})+$"

  # Error Model Enforcement
  error-response-model:
    description: "Error responses (4xx, 5xx) must use the ProblemDetails schema."
    given: "$.paths..responses[?(@property >= 400 && @property < 600)].content.*.schema"
    then:
      field: "$ref"
      function: pattern
      functionOptions:
        match: "#/components/schemas/ProblemDetail"

  # Enforce Request naming: Must end in 'Request' or 'Command'
  # Targets schema names that start with Create/Update/Patch
  schema-names-request:
    description: "Request schemas (Create/Update/Patch) must end with 'Request' or 'Command'"
    severity: warn
    given: "$.components.schemas[?(@property.match(/^(Create|Update|Patch)/))]~"
    then:
      function: pattern
      functionOptions:
        match: "^[A-Z][a-zA-Z0-9]*(Request|Command)$"

  # Enforce Response naming: Must end in 'Response', 'Page', 'Dto', 'Meta', or be a utility schema
  # Excludes schemas starting with Create/Update/Patch and known utility schemas
  schema-names-response:
    description: "Response/Read models must follow naming convention"
    severity: warn
    given: "$.components.schemas[?(!@property.match(/^(Create|Update|Patch)/) && !@property.match(/^ProblemDetail$/))]~"
    then:
      function: pattern
      functionOptions:
        match: "^[A-Z][a-zA-Z0-9]*(Response|Page|List|Dto|Meta|Error)$"