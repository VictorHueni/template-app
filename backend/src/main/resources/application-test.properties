# ========================================
# TEST PROFILE
# ========================================
# Activated automatically in tests via @ActiveProfiles("test")
# Strategy: H2 for @DataJpaTest, Testcontainers PostgreSQL for @SpringBootTest IT
# TestSecurityConfig is active (all endpoints public, no auth)

# ========================================
# 1. DATABASE CONFIGURATION
# ========================================
# H2 in-memory database (default for unit tests like @DataJpaTest)
# Will be overridden by Testcontainers @ServiceConnection in integration tests
spring.datasource.url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.driver-class-name=org.h2.Driver

# Connection Pool (HikariCP) - minimal for tests
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=10000
# spring.datasource.hikari.idle-timeout=60000 (not needed in tests)
# spring.datasource.hikari.max-lifetime=180000 (not needed in tests)

# ========================================
# 2. JPA/HIBERNATE CONFIGURATION
# ========================================
# create-drop for H2 unit tests
# Will be overridden to 'update' by AbstractIntegrationTest for Testcontainers
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.show_sql=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.open-in-view=false

# SQL Initialization
spring.sql.init.mode=never

# ========================================
# 3. WEB SERVER CONFIGURATION
# ========================================
# Random port for parallel test execution
server.port=0
server.servlet.context-path=/api

# Compression (not needed in tests)
# server.compression.enabled=false

# ========================================
# 4. SECURITY CONFIGURATION
# ========================================
# TestSecurityConfig is active (@Profile("test"))
# All endpoints are public, no authentication required
# CORS and admin credentials not used in tests
# cors.allowed.origins=http://localhost:* (handled by TestSecurityConfig)
# admin.username=n/a
# admin.password=n/a

# Cookie secure (inherited from application.properties: false)

# ========================================
# 5. ACTUATOR CONFIGURATION
# ========================================
# Minimal actuator in tests
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=false
# management.info.env.enabled=false (not needed in tests)
# management.info.java.enabled=false
# management.info.os.enabled=false

# ========================================
# 6. LOGGING CONFIGURATION
# ========================================
# Balanced logging for tests (reduce noise)
logging.level.root=WARN
logging.level.com.example.demo=DEBUG
logging.level.org.springframework=WARN
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.boot.actuate=WARN
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.springframework.jdbc.core=DEBUG

# Testcontainers logging (for integration tests)
logging.level.org.testcontainers=INFO
logging.level.tc=INFO

# Log pattern (simple for tests)
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Log to file (not needed in tests)
# logging.file.name=logs/test.log
# logging.file.max-size=10MB
# logging.file.max-history=10

# ========================================
# 7. ERROR HANDLING
# ========================================
# Minimal error details in tests
server.error.include-stacktrace=never
server.error.include-message=never
server.error.include-binding-errors=never

# ========================================
# 8. TESTCONTAINERS CONFIGURATION
# ========================================
# Testcontainers automatically detected via @ServiceConnection
# No explicit configuration needed here
# PostgreSQL container configured in TestcontainersConfiguration.java
# Integration tests extending AbstractIntegrationTest will use PostgreSQL
# Unit tests (@DataJpaTest) will use H2 configured above

