# ========================================
# BASE APPLICATION CONFIGURATION
# ========================================
# Common configuration shared across all profiles
# Profile-specific: application-{profile}.properties

# ========================================
# 1. APPLICATION SETTINGS
# ========================================
spring.application.name=demo

# Default profile (used when no profile is explicitly set)
spring.profiles.default=local

# ========================================
# 2. SESSION & COOKIE CONFIGURATION (ALL PROFILES)
# ========================================
# Disable URL-based session tracking for maximum security
server.servlet.session.tracking-modes=COOKIE

# Set SameSite=Strict to mitigate CSRF (fixes ZAP 10054)
server.servlet.session.cookie.same-site=strict

# Add HttpOnly (prevents client-side script access to the cookie)
server.servlet.session.cookie.http-only=true

# Add Secure (ensure cookie is only sent over HTTPS/SSL)
# Default is false for local/dev (HTTP), override to true in production profile
server.servlet.session.cookie.secure=${COOKIE_SECURE:false}

# ========================================
# 3. ERROR HANDLING CONFIGURATION
# ========================================
# Enable RFC 7807 Problem Details for HTTP APIs (Spring Boot 3+)
spring.mvc.problemdetails.enabled=true

# ========================================
# 4. ACTUATOR CONFIGURATION (DEFAULT)
# ========================================
# These can be overridden in profile-specific files
# Security: Use custom base path to obscure actuator endpoints from scanners
management.endpoints.web.base-path=/management
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=when-authorized

# ========================================
# 5. SECURITY FILTER REGISTRATION
# ========================================
# Force Spring Security to run on Error and Forward dispatches so headers are written to 404 pages
spring.security.filter.dispatcher-types=request,async,error,forward,include

# ========================================
# 6. HIBERNATE ENVERS CONFIGURATION
# ========================================
# Audit table suffix (creates greeting_AUD for greeting table)
spring.jpa.properties.org.hibernate.envers.audit_table_suffix=_AUD
# Revision field names in audit tables
spring.jpa.properties.org.hibernate.envers.revision_field_name=REV
spring.jpa.properties.org.hibernate.envers.revision_type_field_name=REVTYPE
# Store entity data when deleted (enables full audit trail)
spring.jpa.properties.org.hibernate.envers.store_data_at_delete=true
# ValidityAuditStrategy: Adds REVEND column for faster historical queries
# Uses range conditions instead of correlated subqueries for point-in-time lookups
spring.jpa.properties.org.hibernate.envers.audit_strategy=org.hibernate.envers.strategy.internal.ValidityAuditStrategy

# ========================================
# 7. SPRING MODULITH CONFIGURATION
# ========================================
# Enable automatic schema initialization for the EVENT_PUBLICATION (outbox) table
# This creates the transactional event store table used by Spring Modulith
spring.modulith.events.jdbc-schema-initialization.enabled=true

# Completion mode: DELETE removes events from outbox after successful delivery
# This keeps the technical outbox table lean (vs. ARCHIVE which marks as completed)
spring.modulith.events.completion-mode=DELETE

# ========================================
# 8. MICROMETER TRACING CONFIGURATION
# ========================================
# Enable tracing for distributed trace_id propagation
management.tracing.enabled=true
management.tracing.sampling.probability=1.0

