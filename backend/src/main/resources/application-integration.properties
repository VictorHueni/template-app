# ========================================
# INTEGRATION TEST PROFILE
# ========================================
# This profile is activated for PostgreSQL Testcontainers integration tests
# Usage: @ActiveProfiles({"test", "integration"})

# ========================================
# 1. FLYWAY CONFIGURATION
# ========================================
# Enable Flyway for PostgreSQL Testcontainers
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.modulith.runtime.flyway-enabled=false
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0

# ========================================
# 2. JPA/HIBERNATE CONFIGURATION
# ========================================
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.defer-datasource-initialization=true

# ========================================
# 3. SQL INITIALIZATION
# ========================================
# Disable legacy SQL init (Flyway handles schema)
spring.sql.init.mode=never

# ========================================
# 4. SPRING MODULITH CONFIGURATION
# ========================================
# Disable auto-schema (Flyway manages event_publication table)
# The integration profile uses @SpringBootTest with @ContextConfiguration to ensure
# proper Spring Boot auto-configuration loading (including Flyway auto-configuration)
spring.modulith.events.jdbc.schema-initialization.enabled=false

# ========================================
# 5. DEBUG LOGGING FOR TROUBLESHOOTING
# ========================================
# Enable debug logging for Flyway to diagnose migration issues
logging.level.org.flywaydb=DEBUG
logging.level.org.flywaydb.core.internal=DEBUG
# Enable Spring Boot auto-configuration debug to see bean creation order
#logging.level.org.springframework.boot.autoconfigure=DEBUG
