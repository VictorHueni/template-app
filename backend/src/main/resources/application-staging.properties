# ========================================
# STAGING PROFILE (QA / ACCEPTANCE)
# ========================================
# This profile is used for QA and acceptance testing environments
# Usage: java -jar app.jar --spring.profiles.active=staging

# ========================================
# 1. DATABASE CONFIGURATION
# ========================================
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool (HikariCP) - production-like settings
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ========================================
# 2. JPA/HIBERNATE CONFIGURATION
# ========================================
# Validate schema matches Flyway migrations (no auto DDL)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.show_sql=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.open-in-view=false
spring.jpa.defer-datasource-initialization=true


# ========================================
# 3. WEB SERVER CONFIGURATION
# ========================================
server.port=${SPRING_SERVER_PORT:8080}
server.servlet.context-path=/api

# Compression enabled (production-like)
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain

# ========================================
# 4. SECURITY CONFIGURATION
# ========================================
# CORS (configured via environment)
cors.allowed.origins=${CORS_ALLOWED_ORIGINS}

# Admin credentials (from environment - required)
admin.username=${ADMIN_USERNAME}
admin.password=${ADMIN_PASSWORD}

# Cookie secure (should be true if HTTPS)
server.servlet.session.cookie.secure=${COOKIE_SECURE:true}

# ========================================
# 5. ACTUATOR CONFIGURATION
# ========================================
# Staging: Separate management port, limited exposure
management.server.port=${MANAGEMENT_SERVER_PORT:8081}
management.server.base-path=/
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true

# Info endpoint - no sensitive data
management.info.env.enabled=false
management.info.java.enabled=true
management.info.os.enabled=false
management.info.build.enabled=true
management.info.git.enabled=true
management.info.git.mode=simple

# ========================================
# 6. LOGGING CONFIGURATION
# ========================================
# Production-like logging (INFO level, minimal noise)
logging.level.root=INFO
logging.level.com.example.demo=INFO
logging.level.org.springframework=WARN
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.boot.actuate=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.springframework.jdbc.core=WARN

# Log pattern (structured for log aggregation)
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Log to file (recommended for staging)
logging.file.name=${LOG_FILE:/var/log/demo-app/staging.log}
logging.file.max-size=50MB
logging.file.max-history=30

# ========================================
# 7. ERROR HANDLING
# ========================================
# Production-like: hide internals
spring.web.error.include-stacktrace=never
spring.web.error.include-message=always
spring.web.error.include-binding-errors=never
