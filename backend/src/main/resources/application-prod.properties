# ========================================
# PRODUCTION PROFILE
# ========================================
# Production environments - ALL sensitive values via environment variables
# Usage: java -jar app.jar --spring.profiles.active=prod

# ========================================
# 1. DATABASE CONFIGURATION
# ========================================
# All connection details MUST be provided via environment variables
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection pool sized for production load
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ========================================
# 2. JPA/HIBERNATE CONFIGURATION
# ========================================
# Validate mode: schema must match Flyway migrations (no auto DDL allowed)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Note: format_sql, show_sql, jdbc.time_zone, open_in_view, defer_datasource_initialization inherited from base

# Disable legacy SQL initialization (Flyway manages all migrations)
spring.sql.init.mode=never

# ========================================
# 3. WEB SERVER CONFIGURATION
# ========================================
server.port=${SERVER_PORT:8080}

# Note: server.servlet.context-path inherited from base

# Enable compression to optimize bandwidth for client requests
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json

# ========================================
# 4. SECURITY CONFIGURATION
# ========================================
# CORS origins must be provided via environment variable
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:https://yourdomain.com}

# Note: admin.username inherited from base
# Admin password required from environment
admin.password=${ADMIN_PASSWORD}

# Force secure cookies (HTTPS only) - always enabled in production
server.servlet.session.cookie.secure=true

# ========================================
# 5. ACTUATOR CONFIGURATION
# ========================================
# Separate management port for network-level isolation - allows firewall rules to block actuator access
management.server.port=${MANAGEMENT_SERVER_PORT:8081}
management.server.base-path=/
# Only health endpoint exposed (required for K8s liveness/readiness probes)
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true

# Minimal info endpoint - only build/git metadata (no environment/Java/OS info to prevent info leakage)
management.info.build.enabled=true
management.info.env.enabled=false
management.info.git.enabled=true
management.info.git.mode=simple
management.info.java.enabled=false
management.info.os.enabled=false

# ========================================
# 6. LOGGING CONFIGURATION
# ========================================
# Minimal logging for production (WARN level reduces I/O and noise)
logging.level.root=WARN
logging.level.com.example.demo=INFO
logging.level.org.springframework=WARN
logging.level.org.springframework.boot.actuate=WARN
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN

# Log pattern with timestamp for correlation with external monitoring
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Centralized logging recommended (ELK stack, CloudWatch, etc.) instead of local files
# logging.file.name=/var/log/demo-app/application.log
# logging.file.max-size=10MB
# logging.file.max-history=30

# ========================================
# 7. ERROR HANDLING
# ========================================
# Never expose sensitive information to clients - production security principle
spring.web.error.include-binding-errors=never
spring.web.error.include-message=never
spring.web.error.include-stacktrace=never

# ========================================
# 8. TESTCONTAINERS CONFIGURATION
# ========================================
# N/A - Testcontainers used only in test profiles

# ========================================
# 9. FLYWAY CONFIGURATION
# ========================================
# Flyway enabled and validates all migrations have been applied
spring.flyway.enabled=true

# Note: baseline-on-migrate, baseline-version, locations, and runtime.flyway-enabled inherited from base

# ========================================
# 10. SPRING MODULITH CONFIGURATION
# ========================================
# Disable auto-schema for event_publication table (Flyway manages all schema)
spring.modulith.events.jdbc.schema-initialization.enabled=false

# ========================================
# 11. OAUTH2 RESOURCE SERVER CONFIGURATION
# ========================================
# Spring Addons OIDC Configuration - issuer MUST be provided via environment
com.c4-soft.springaddons.oidc.ops[0].iss=${KEYCLOAK_ISSUER}
com.c4-soft.springaddons.oidc.ops[0].username-claim=$.preferred_username
com.c4-soft.springaddons.oidc.ops[0].authorities[0].path=$.realm_access.roles
com.c4-soft.springaddons.oidc.ops[0].authorities[0].prefix=ROLE_
com.c4-soft.springaddons.oidc.ops[0].aud=template-gateway

# Resource Server Configuration - matches OpenAPI spec security definitions
com.c4-soft.springaddons.oidc.resourceserver.permit-all=/error,/v1/greetings,/v1/greetings/**
