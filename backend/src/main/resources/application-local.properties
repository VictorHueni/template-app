# ========================================
# LOCAL DEVELOPMENT PROFILE
# ========================================
# Local development environment (default profile)
# Docker: docker run --name spring-postgres -p 5432:5432 -e POSTGRES_DB=spring_db -e POSTGRES_USER=spring_user -e POSTGRES_PASSWORD=secure_password -d postgres:18.1-alpine
# Usage: mvn spring-boot:run (or run directly from IDE)

# ========================================
# 1. DATABASE CONFIGURATION
# ========================================
# Connection details with sensible defaults for local PostgreSQL
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/spring_db}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:spring_user}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:secure_password}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection pool sized for local development
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ========================================
# 2. JPA/HIBERNATE CONFIGURATION
# ========================================
# Validate mode: schema must match Flyway migrations (no auto DDL)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Override base defaults for local development visibility
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.show_sql=true
spring.jpa.open-in-view=true
spring.jpa.defer-datasource-initialization=false

# Note: jdbc.time_zone inherited from base

# ========================================
# 3. WEB SERVER CONFIGURATION
# ========================================
server.port=${SPRING_SERVER_PORT:8081}

# Note: server.servlet.context-path inherited from base

# Compression disabled for easier debugging

# ========================================
# 4. SECURITY CONFIGURATION
# ========================================
# CORS configured for local frontend development
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:http://localhost:5173,http://localhost:3000}

# Note: admin.username inherited from base
# Admin password with local development defaults
admin.password=${ADMIN_PASSWORD:localpassword}

# Cookie secure inherited from application.properties (false for local HTTP)

# ========================================
# OAUTH2 RESOURCE SERVER CONFIGURATION
# ========================================
# Spring Addons OIDC Configuration
# Default: localhost:9000 for local dev, override via KEYCLOAK_ISSUER env var for Docker
com.c4-soft.springaddons.oidc.ops[0].iss=${KEYCLOAK_ISSUER:http://localhost:9000/realms/template-realm}
com.c4-soft.springaddons.oidc.ops[0].username-claim=$.preferred_username
com.c4-soft.springaddons.oidc.ops[0].authorities[0].path=$.realm_access.roles
com.c4-soft.springaddons.oidc.ops[0].aud=template-gateway

# Resource Server Configuration - matches OpenAPI spec security definitions
# Note: Paths are relative to context-path (/api), so /v1/greetings = /api/v1/greetings
com.c4-soft.springaddons.oidc.resourceserver.permit-all=/error,/v1/greetings,/v1/greetings/**

# ========================================
# 5. ACTUATOR CONFIGURATION
# ========================================
# Separate management port for consistency with dev/prod
management.server.port=${MANAGEMENT_SERVER_PORT:8082}
management.server.base-path=/
# Verbose actuator for local development debugging
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true

# All info contributors enabled for local development visibility
management.info.build.enabled=true
management.info.env.enabled=true
management.info.git.enabled=true
management.info.git.mode=full
management.info.java.enabled=true
management.info.os.enabled=true

# ========================================
# 6. LOGGING CONFIGURATION
# ========================================
# Very verbose logging for local development debugging
logging.level.root=INFO
logging.level.com.example.demo=DEBUG
logging.level.org.springframework=INFO
logging.level.org.springframework.boot.actuate=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.web=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.springframework.jdbc.core=DEBUG

# Log pattern with timestamp for easy correlation
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Optional file logging for local development
# logging.file.name=logs/local.log
# logging.file.max-size=10MB
# logging.file.max-history=10

# ========================================
# 7. ERROR HANDLING
# ========================================
# Show all details for debugging in local development
spring.web.error.include-binding-errors=always
spring.web.error.include-message=always
spring.web.error.include-stacktrace=always

# ========================================
# 8. TESTCONTAINERS CONFIGURATION
# ========================================
# N/A - Testcontainers used only in test profiles

# ========================================
# 9. FLYWAY CONFIGURATION
# ========================================
# Flyway enabled to manage PostgreSQL schema in local development
spring.flyway.enabled=true

# Note: baseline-on-migrate, baseline-version, locations, and runtime.flyway-enabled inherited from base

# ========================================
# 10. SPRING MODULITH CONFIGURATION
# ========================================
# Disable auto-schema for event_publication table (Flyway manages all schema)
spring.modulith.events.jdbc.schema-initialization.enabled=false
