# ============================================================================
# JUNIT 5 PARALLEL EXECUTION CONFIGURATION FOR INTEGRATION TESTS
# ============================================================================
#
# This configuration enables efficient parallel test execution while maintaining
# proper test isolation for shared resources (database).
#
# STRATEGY: Dynamic Resource Locking
# - Tests with @ResourceLock annotations acquire exclusive access to locked resources
# - Only one test at a time can hold a READ_WRITE lock on the database
# - Other tests wait in queue until the resource is released
# - This prevents race conditions and flaky tests while preserving parallelism
#
# WHY THIS MATTERS:
# Before fix: Tests ran in true parallel despite @ResourceLock annotations (fixed strategy)
#   Result: Concurrent database access → race conditions → flaky tests
# After fix: Tests respect @ResourceLock with dynamic strategy
#   Result: Serialized database access → test isolation → reliable tests
#
# ============================================================================

# Enable parallel test execution (required for dynamic strategy to work)
junit.jupiter.execution.parallel.enabled=true

# Test methods within a class run sequentially (avoid intra-class parallelism)
junit.jupiter.execution.parallel.mode.default=same_thread

# Test classes run in parallel (allows multiple test classes to execute concurrently)
junit.jupiter.execution.parallel.mode.classes.default=concurrent

# CRITICAL: Use dynamic strategy to enable @ResourceLock respect
# This is the key to preventing flaky tests while maintaining parallelism.
# With dynamic strategy:
# - JUnit checks @ResourceLock before starting each test
# - Tests with locks wait for resources to be available
# - Read-write locks ensure exclusive database access during test execution
junit.jupiter.execution.parallel.config.strategy=dynamic

# Dynamic parallelism factor: 1.0 = number of CPU cores available
# Using 1.0 to prevent excessive lock contention on database resources.
# Higher values (like 8.0) can cause race conditions even with @ResourceLock
# because of timing issues during lock acquisition/release.
junit.jupiter.execution.parallel.config.dynamic.factor=1.0
